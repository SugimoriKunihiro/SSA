<!DOCTYPE html>
<html>
  <head>
    <title>ARIEL</title>
    <base target="_top">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"    
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" 
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" 
      integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" 
      integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <!-- Google ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®æ­£ã—ã„è¨­å®š -->
    <meta name="google-signin-client_id" content="50428583319-gicuh9uve4gcj36a5huuhm5m0jcb3fr4.apps.googleusercontent.com">

    <style>
      /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
      html, body {
        margin: 0;
        height: 100%;
        overflow: hidden;
        background-color: #343a40;
        color: white;
      }

      /* ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚¹ã‚¿ã‚¤ãƒ« */
      #app {
        height: 100%;
        overflow: hidden;
        display: none; /* æœ€åˆã¯éè¡¨ç¤º */
      }

      .fullscreen-appsheet {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 1;
      }

      .fullscreen-appsheet iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
      
      /* AppSheetãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .appsheet-helper {
        opacity: 0.95;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transition: opacity 0.3s ease;
      }
      
      .appsheet-helper:hover {
        opacity: 1;
      }

      #nav-hover-zone {
        position: fixed;
        top: 0;
        left: 0;
        height: 30px;
        width: 100vw;
        background: transparent;
        z-index: 100;
        pointer-events: auto;
      }

      #nav-hover-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 40px;
        background-color: #343a40;
        color: white;
        z-index: 101;
        transform: translateY(-100%);
        transition: transform 0.4s ease-in-out;
        pointer-events: auto;
      }

      #nav-hover-bar.active {
        transform: translateY(0%);
      }

      /* èªè¨¼é–¢é€£ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #auth-page {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
        background-color: #343a40;
      }

      .auth-container {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
        text-align: center;
      }

      .title {
        margin-bottom: 30px;
        font-size: 2rem;
      }

      .login-methods {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .custom-signin-button {
        background-color: white;
        color: #444;
        border-radius: 5px;
        border: none;
        padding: 10px 15px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .custom-signin-button:hover {
        background-color: #f1f1f1;
      }

      .custom-signin-button img {
        margin-right: 10px;
        width: 18px;
        height: 18px;
      }

      #errorMessage {
        color: #ff6b6b;
        margin-top: 15px;
        display: none;
      }

      .hidden {
        display: none;
      }

      .user-auth-status {
        position: fixed;
        top: 10px;
        right: 15px;
        z-index: 102;
        display: flex;
        align-items: center;
        color: white;
        font-size: 0.8rem;
      }
      
      .user-email {
        margin-right: 10px;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      .logout-btn {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      
      .logout-btn:hover {
        background-color: rgba(255, 255, 255, 0.3);
      }

      #loading-view {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
    </style>
  </head>

  <body>
    <!-- èªè¨¼ãƒšãƒ¼ã‚¸ -->
    <div id="auth-page">
      <div class="auth-container">
        <h1 class="title">ARIEL ãƒãƒ¼ã‚¿ãƒ«</h1>
        
        <div id="login-view">
          <p>ç¶šè¡Œã™ã‚‹ã«ã¯èªè¨¼ãŒå¿…è¦ã§ã™</p>
          
          <div class="login-methods">
            <!-- Google ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="d-flex justify-content-center">
              <div id="g-signin2" class="g-signin2" data-onsuccess="onSignIn"></div>
            </div>
            
            <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤ºæ¬„ -->
            <div id="debugInfo" class="mt-3 text-left bg-dark p-2 rounded" style="font-size: 0.8rem; color: #aaa; display: block;">
              <div id="debugGAPI">GAPIçŠ¶æ…‹: ç¢ºèªä¸­...</div>
              <div id="debugAuth">Auth2çŠ¶æ…‹: ç¢ºèªä¸­...</div>
              <div id="debugRedirectUri">è¨­å®šæ¸ˆã¿ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI: https://sugimorikuihiro.github.io/ARIEL/</div>
            </div>

            <!-- ã¾ãŸã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³ã®ãƒœã‚¿ãƒ³ -->
            <button onclick="triggerGoogleSignIn()" class="custom-signin-button mt-3">
              <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google logo">
              Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
            </button>
            
            <!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯èªè¨¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
            <div id="fallback-signin-options" class="mt-4 pt-3 border-top" style="display: none;">
              <p class="text-warning small"><strong>èªè¨¼ã«å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã™</strong></p>
              <p class="small">ä»¥ä¸‹ã®æ‰‹é †ã‚’ãŠè©¦ã—ãã ã•ã„:</p>
              <ol class="small text-left">
                <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£Cookieã‚’è¨±å¯ã™ã‚‹</li>
                <li>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ãƒ¢ãƒ¼ãƒ‰ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹ã«ã™ã‚‹</li>
                <li>ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã‚‹</li>
                <li>åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§è©¦ã™ (Chromeæ¨å¥¨)</li>
              </ol>
              <button onclick="tryAlternativeSignIn()" class="btn btn-sm btn-warning mt-2">
                åˆ¥ã®æ–¹æ³•ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
              </button>
            </div>
          </div>
          
          <div id="errorMessage"></div>
        </div>
        
        <div id="loading-view" class="hidden">
          <div class="d-flex justify-content-center">
            <div class="spinner-border text-light" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <p class="mt-3">èªè¨¼ä¸­...</p>
        </div>
      </div>
    </div>

    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <div class="user-auth-status" id="user-auth-status" style="display: none;">
      <span class="user-email" id="user-email"></span>
      <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª -->
    <div id="app"><!--appã“ã“ã‹ã‚‰-->

      <!-- iframeå…¨ç”»é¢ -->
      <div class="fullscreen-appsheet" id="appsheet-container-99999" v-show="showContents[0] === '99999'">
        <iframe
          src="https://www.appsheet.com/start/b3cc011c-f2d9-4021-b16f-2efdd921a42b"
          ref="fullscreenFrame"
          :style="{
            width: '100%',
            height: '100%',
            border: 'none',
            pointerEvents: showNav ? 'none' : 'auto'
          }"
          scrolling="no"
          allowfullscreen
          allow="clipboard-read; clipboard-write;"
          @load="handleIframeLoad"
          @error="iframeError = true">
        </iframe>
        
        <!-- AppSheetå°‚ç”¨ã®ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div v-if="!alreadyOpened" 
             class="appsheet-helper alert alert-info m-3 position-absolute" 
             style="top: 0; left: 0; right: 0; max-width: 600px; margin: 0 auto; z-index: 10;">
          <button type="button" class="close" @click="alreadyOpened = true">&times;</button>
          <h5>AppSheetã‚¢ãƒ—ãƒªã«ã¤ã„ã¦</h5>
          <p>è¡¨ç¤ºã«å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€ä¸‹è¨˜ã®ã€Œæ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚ã¾ãŸã¯X-frame headerã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«å°å…¥ã—ã¦ãã ã•ã„</p>
          <button @click="openAppsheetInNewTab" class="btn btn-primary btn-sm">
            æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
          </button>
        </div>
      </div>

      <!-- ã‚¨ãƒ©ãƒ¼æ™‚ã®å¼·åŒ–ã•ã‚ŒãŸAppSheetãƒªã‚«ãƒãƒªãƒ¼UI -->
      <div v-if="iframeError" class="d-flex flex-column align-items-center my-4 p-3 bg-light rounded">
        <div class="alert alert-danger mb-3 w-100" role="alert">
          <h4 class="alert-heading">
            <span class="mr-2">âš ï¸</span> 
            AppSheetã‚¢ãƒ—ãƒªã®è¡¨ç¤ºã«å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã™
          </h4>
          <p>ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªåŸå› ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ï¼š</p>
          <ul>
            <li>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œï¼ˆä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åˆ¶é™ãªã©ï¼‰</li>
            <li>AppSheetã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®å•é¡Œ</li>
            <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®èªè¨¼æƒ…å ±ã‚„Cookieã®å•é¡Œ</li>
          </ul>
        </div>
        
        <div class="d-flex flex-column flex-md-row mb-3 w-100 justify-content-center">
          <button @click="openAppsheetFallback" class="btn btn-primary btn-lg m-2">
            <span class="mr-2">ğŸ”—</span> 
            AppSheetã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
          </button>
          
          <button @click="troubleshootAppSheet" class="btn btn-outline-secondary btn-lg m-2">
            <span class="mr-2">ğŸ”§</span>
            ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
          </button>
        </div>
        
        <small class="text-muted mb-2">â€» ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¨±å¯ã—ã¦ãã ã•ã„</small>
        
        <div class="card w-100 mt-3">
          <div class="card-header bg-info text-white">
            ã•ã‚‰ã«è©³ã—ã„è§£æ±ºæ–¹æ³•
          </div>
          <div class="card-body">
            <ol>
              <li>Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ç›´æ¥ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
              <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã‚„åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„</li>
              <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨Cookieã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„</li>
              <li>ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€å€‹äººå›ç·šã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„</li>
              <li>ç›´æ¥ <a href="https://www.appsheet.com" target="_blank">AppSheet</a> ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸå¾Œã€ã“ã®ãƒãƒ¼ã‚¿ãƒ«ã«æˆ»ã£ã¦ãã¦ãã ã•ã„</li>
            </ol>
          </div>
        </div>
        
        <button @click="resetAppSheetError" class="btn btn-link mt-3">
          ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’é–‰ã˜ã‚‹
        </button>
      </div>

      <!-- ãƒ›ãƒãƒ¼ã‚¾ãƒ¼ãƒ³ã¨ãƒŠãƒ“ -->
      <div id="nav-hover-zone" v-show="showContents[0] !== '99999'" @mouseenter="showNav = true" @mouseleave="showNav = false"></div>
      <nav 
        id="nav-hover-bar"
        class="navbar navbar-expand-lg navbar-dark bg-secondary px-3"
        :class="{ active: showNav }"
        @mouseenter="showNav = true"
        @mouseleave="showNav = false">
        <h3 class="navbar-brand" @click="toggle('99999')">ARIEL</h3>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        
        <!--ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã“ã“ã‹ã‚‰-->
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
   
           <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã‹ã‚‰-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Knowledge</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="knowledge in knowledges" :key="knowledge.id" class="dropdown-item" v-bind:href="knowledge.url" target="_blank">{{knowledge.name}}</a>
              </div>
            </li>
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã¾ã§-->
            
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã‹ã‚‰-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Learning</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="learning in learnings" :key="learning.id" class="dropdown-item" v-bind:href="learning.url" target="_blank">{{learning.name}}</a>
              </div>
            </li>
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã¾ã§-->
        
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã‹ã‚‰-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Drive</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="drive in drives" :key="drive.id" class="dropdown-item" v-bind:href="drive.url" target="_blank">{{drive.name}}</a>
              </div>
            </li>
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã¾ã§-->

            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã‹ã‚‰-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Google</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="gsuite in gsuites" :key="gsuite.id" class="dropdown-item" v-bind:href="gsuite.url" target="_blank">{{gsuite.name}}</a>
              </div>
            </li>
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã¾ã§-->

            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã‹ã‚‰-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">App</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="tool in tools" :key="tool.id" class="dropdown-item" v-bind:href="tool.url" target="_blank">{{tool.name}}</a>
              </div>
            </li>
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã¾ã§-->

            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã‹ã‚‰-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">IT</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="it in its" :key="it.id" class="dropdown-item" v-bind:href="it.url" target="_blank">{{it.name}}</a>
              </div>
            </li>
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã¾ã§-->

            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã‹ã‚‰-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Media</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="tv in tvs" :key="tv.id" class="dropdown-item" v-bind:href="tv.url" target="_blank">{{tv.name}}</a>
              </div>
            </li>
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã¾ã§-->

            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã‹ã‚‰-->
             <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">SNS/Private</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="prv in prvs" :key="prv.id" class="dropdown-item" v-bind:href="prv.url" target="_blank">{{prv.name}}</a>
              </div>
            </li>
            <!--ã‚«ãƒ†ã‚´ãƒªæ¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³(ãƒªãƒ³ã‚¯)ã“ã“ã¾ã§-->
          </ul>
        </div>
        <!--ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã“ã“ã¾ã§-->
      </nav>
      <!--ãƒŠãƒ“ãƒãƒ¼ã“ã“ã¾ã§-->
      </br>
       
       <!--ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«å¯¾ã™ã‚‹ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã“ã“ã‹ã‚‰-->
        <div id="sub">
          <!-- ç©ºã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å¯¾å¿œé ˜åŸŸ -->
        </div>
        <!--ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«å¯¾ã™ã‚‹ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã“ã“ã¾ã§-->
      
    </div>
    <!--appã“ã“ã¾ã§-->

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <script>
      // èªè¨¼é–¢é€£ã®è¨­å®š
      // --------------------------------------------
      
      // å›ºå®šãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’ä½¿ç”¨ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ - URIã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã“ã¨ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã®ä¸ä¸€è‡´ã‚’è§£æ±º
      const useFixedRedirectUri = true; // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã®å•é¡ŒãŒã‚ã‚‹å ´åˆã¯trueã«è¨­å®š
      const fixedRedirectUri = 'https://sugimorikuihiro.github.io/ARIEL/';  // Google Consoleã«ç™»éŒ²ã—ãŸURIã¨å®Œå…¨ã«ä¸€è‡´ã•ã›ã‚‹

      // ç¾åœ¨ã®URLã‹ã‚‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’å–å¾—ã™ã‚‹ï¼ˆé€šå¸¸ã®æ–¹æ³•ï¼‰
      function getCurrentRedirectUri() {
        if (useFixedRedirectUri) {
          console.log('å›ºå®šãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’ä½¿ç”¨:', fixedRedirectUri);
          return fixedRedirectUri;
        }
        
        // é€šå¸¸ã®æ–¹æ³•ã§URLã‚’å‡¦ç†
        const currentUrl = window.location.href.split('?')[0]; // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é™¤å»
        const redirectUri = currentUrl.replace(/#.*$/, ''); // ãƒãƒƒã‚·ãƒ¥ã‚‚é™¤å»
        console.log('å‹•çš„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’ä½¿ç”¨:', redirectUri);
        return redirectUri;
      }
      
      // è¨±å¯ã™ã‚‹Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆé…åˆ—ã«è¿½åŠ ã—ã¦è¤‡æ•°è¨­å®šå¯èƒ½ï¼‰
      const allowedEmails = [
        'k.sugimori.cz@gmail.com',
        'k.sugimori.p@gmail.com',
        'sugimori@skyarch.net'
        // å¿…è¦ã«å¿œã˜ã¦è¿½åŠ 
      ];
      
      // Googleèªè¨¼ã®åˆæœŸåŒ–é–¢æ•°ã‚’æ”¹å–„
      function initGoogleAuth() {
        // ã™ã§ã«åˆæœŸåŒ–æ¸ˆã¿ãªã‚‰å‡¦ç†ã—ãªã„
        if (googleAuthInitialized) return;
        
        // åˆå›ä»¥å¤–ã¯æœ€åˆã«ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º
        if (!firstLoadAttempt) {
          document.getElementById('debugInfo').style.display = 'block';
        }
        firstLoadAttempt = false;
        
        console.log('Googleèªè¨¼ã®åˆæœŸåŒ–ã‚’é–‹å§‹ã—ã¾ã™...');
        
        // gapiãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
        if (typeof gapi === 'undefined') {
          console.error('Google API (gapi) ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          document.getElementById('debugGAPI').textContent = 'GAPIçŠ¶æ…‹: æœªèª­ã¿è¾¼ã¿';
          // 1ç§’å¾Œã«å†è©¦è¡Œ
          setTimeout(initGoogleAuth, 1000);
          return;
        }
        
        console.log('GAPIæ¤œå‡º: èª­ã¿è¾¼ã¿é–‹å§‹');
        document.getElementById('debugGAPI').textContent = 'GAPIçŠ¶æ…‹: æ¤œå‡ºæ¸ˆã¿ã€auth2èª­ã¿è¾¼ã¿ä¸­...';
        
        // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’å–å¾—
        const redirectUri = getCurrentRedirectUri();
        console.log('ä½¿ç”¨ã™ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI:', redirectUri);
        document.getElementById('debugAuth').textContent = 'Auth2çŠ¶æ…‹: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI: ' + redirectUri;
        
        // auth2ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€
        gapi.load('auth2', function() {
          console.log('Auth2ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');
          document.getElementById('debugGAPI').textContent = 'GAPIçŠ¶æ…‹: auth2ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†';
          
          try {
            // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ - ã“ã“ãŒé‡è¦ãªä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ
            let auth2 = null;
            try {
              auth2 = gapi.auth2.getAuthInstance();
              console.log('æ—¢å­˜ã®auth2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ã—ã¾ã—ãŸ');
              document.getElementById('debugAuth').textContent = 'Auth2çŠ¶æ…‹: æ—¢å­˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨';
            } catch (e) {
              console.log('æ—¢å­˜ã®auth2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“');
              auth2 = null;
            }
            
            if (auth2) {
              // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
              googleAuth2Instance = auth2;
              googleAuthInitialized = true;
              
              console.log('æ—¢å­˜ã®Google Auth2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™');
              
              // ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®è¨­å®š
              setupSignInButton(auth2);
              
              // ã™ã§ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
              if (auth2.isSignedIn.get()) {
                const googleUser = auth2.currentUser.get();
                onSignIn(googleUser);
              }
            } else {
              // æ–°è¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
              gapi.auth2.init({
                client_id: '50428583319-gicuh9uve4gcj36a5huuhm5m0jcb3fr4.apps.googleusercontent.com',
                cookiepolicy: 'single_host_origin',
                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§ã¯ãªããƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
                ux_mode: 'redirect',
                redirect_uri: redirectUri, // æ˜ç¤ºçš„ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’æŒ‡å®š
                scope: 'profile email'
              }).then(function(auth2) {
                // åˆæœŸåŒ–æˆåŠŸã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
                googleAuth2Instance = auth2;
                googleAuthInitialized = true;
                
                console.log('Google Auth2åˆæœŸåŒ–æˆåŠŸ');
                document.getElementById('debugAuth').textContent = 'Auth2çŠ¶æ…‹: åˆæœŸåŒ–å®Œäº†';
                
                // ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®è¨­å®š
                setupSignInButton(auth2);
                
                // ã™ã§ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (auth2.isSignedIn.get()) {
                  const googleUser = auth2.currentUser.get();
                  onSignIn(googleUser);
                }
              }).catch(function(error) {
                // åˆæœŸåŒ–å¤±æ•—æ™‚ã®è©³ç´°ã‚¨ãƒ©ãƒ¼å‡¦ç†
                handleAuthInitError(error);
              });
            }
          } catch (e) {
            // ä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦è©³ç´°ã‚’è¡¨ç¤º
            console.error('Auth2æ“ä½œä¸­ã®ä¾‹å¤–:', e);
            handleAuthInitError(e);
          }
        }, function(error) {
          // auth2ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—
          console.error('Auth2ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—:', error);
          document.getElementById('debugGAPI').textContent = 'GAPIçŠ¶æ…‹: auth2ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—';
          showError('Googleèªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        });
      }
      
      // èªè¨¼åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†ã‚’åˆ†é›¢
      function handleAuthInitError(error) {
        console.error('Google Auth2åˆæœŸåŒ–å¤±æ•—:', error);
        
        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ã‚’è©³ç´°è¡¨ç¤º
        const errorDetails = JSON.stringify(error, Object.getOwnPropertyNames(error));
        console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', errorDetails);
        
        // ã‚¨ãƒ©ãƒ¼å†…å®¹ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        let errorMessage = 'Googleèªè¨¼ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ';
        let errorCode = '';
        
        try {
          if (error.error) {
            errorCode = error.error;
          } else if (typeof error === 'string') {
            errorCode = error;
          } else if (error.message) {
            errorCode = error.message;
          }
        } catch (e) {
          errorCode = 'ã‚¨ãƒ©ãƒ¼è©³ç´°ã®å–å¾—ã«å¤±æ•—';
        }
        
        // IDPiframeåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ã®ç‰¹åˆ¥å‡¦ç†
        if (errorCode.includes('idpiframe_initialization_failed')) {
          document.getElementById('debugAuth').textContent = 'Auth2çŠ¶æ…‹: iDPiframeåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼';
          errorMessage = `Googleèªè¨¼ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${errorCode}\n\n` +
                          'è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :\n' + 
                          'ãƒ»ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£CookieãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹\n' +
                          'ãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹\n' +
                          'ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã®æ‹¡å¼µæ©Ÿèƒ½ãŒå¹²æ¸‰ã—ã¦ã„ã‚‹';
          
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
          document.getElementById('fallback-signin-options').style.display = 'block';
        } else {
          document.getElementById('debugAuth').textContent = 'Auth2çŠ¶æ…‹: åˆæœŸåŒ–å¤±æ•— - ' + errorCode;
          errorMessage = `Googleèªè¨¼ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${errorCode}`;
        }
        
        showError(errorMessage);
      }

      // ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒœã‚¿ãƒ³è¨­å®šã‚’åˆ†é›¢
      function setupSignInButton(auth2) {
        // æ¨™æº–ã®Googleã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒœã‚¿ãƒ³
        const element = document.getElementById('g-signin2');
        if (element) {
          try {
            // å›ºå®šã¾ãŸã¯å‹•çš„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’å–å¾—
            const redirectUri = getCurrentRedirectUri();
            
            auth2.attachClickHandler(element, {
              // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³
              prompt: 'select_account',    // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠç”»é¢ã‚’è¡¨ç¤º
              ux_mode: 'redirect',         // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
              redirect_uri: redirectUri    // æ˜ç¤ºçš„ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’æŒ‡å®š
            },
            function(googleUser) {
              onSignIn(googleUser);
            },
            function(error) {
              console.error('Sign-in error', error);
              handleSignInError(error);
            });
            console.log('ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã«ãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®šã—ã¾ã—ãŸ');
            console.log('ãƒœã‚¿ãƒ³ç”¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI:', redirectUri);
            document.getElementById('debugAuth').textContent = 'Auth2çŠ¶æ…‹: ãƒœã‚¿ãƒ³è¨­å®šå®Œäº†ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI: ' + redirectUri;
          } catch (e) {
            console.error('ãƒœã‚¿ãƒ³ãƒãƒ³ãƒ‰ãƒ©è¨­å®šã‚¨ãƒ©ãƒ¼:', e);
          }
        } else {
          console.warn('g-signin2è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }
      }

      // Google ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’æ‰‹å‹•ã§ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹é–¢æ•°ã‚’æ”¹å–„
      function triggerGoogleSignIn() {
        document.getElementById('debugInfo').style.display = 'block';
        
        // GAPIãƒã‚§ãƒƒã‚¯
        if (typeof gapi === 'undefined') {
          showError('Googleèªè¨¼APIãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å¾Œã»ã©å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
          return;
        }
        
        try {
          // å›ºå®šã¾ãŸã¯å‹•çš„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’å–å¾—
          const redirectUri = getCurrentRedirectUri();
          console.log('ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒˆãƒªã‚¬ãƒ¼ - ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI:', redirectUri);
          document.getElementById('debugAuth').textContent = 'Auth2çŠ¶æ…‹: ã‚µã‚¤ãƒ³ã‚¤ãƒ³é–‹å§‹ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI: ' + redirectUri;
          
          // ã™ã§ã«åˆæœŸåŒ–æ¸ˆã¿ã®èªè¨¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚‹ã‹ç¢ºèª
          let authInstance;
          try {
            authInstance = gapi.auth2.getAuthInstance();
          } catch (e) {
            console.log('èªè¨¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã¾ã å­˜åœ¨ã—ã¾ã›ã‚“ã€‚åˆæœŸåŒ–ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚');
            authInstance = null;
          }
          
          if (authInstance) {
            // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
            googleAuth2Instance = authInstance;
            googleAuthInitialized = true;
            console.log('æ—¢å­˜ã®Google Auth2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™');
            
            // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
            authInstance.signIn({
              prompt: 'select_account',
              ux_mode: 'redirect',
              redirect_uri: redirectUri // æ˜ç¤ºçš„ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’æŒ‡å®š
            }).then(function(googleUser) {
              onSignIn(googleUser);
            }).catch(function(error) {
              handleSignInError(error);
            });
          } else {
            // åˆæœŸåŒ–ãŒå¿…è¦
            showError('Googleèªè¨¼ã®åˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚');
            
            // æ–°è¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
            gapi.auth2.init({
              client_id: '50428583319-gicuh9uve4gcj36a5huuhm5m0jcb3fr4.apps.googleusercontent.com',
              cookiepolicy: 'single_host_origin',
              ux_mode: 'redirect',
              redirect_uri: redirectUri, // æ˜ç¤ºçš„ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’æŒ‡å®š
              scope: 'profile email'
            }).then(function(auth2) {
              // åˆæœŸåŒ–æˆåŠŸã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
              googleAuth2Instance = auth2;
              googleAuthInitialized = true;
              
              console.log('Google Auth2åˆæœŸåŒ–æˆåŠŸ');
              document.getElementById('debugAuth').textContent = 'Auth2çŠ¶æ…‹: åˆæœŸåŒ–å®Œäº†';
              
              // ã‚µã‚¤ãƒ³ã‚¤ãƒ³å®Ÿè¡Œ
              auth2.signIn({
                prompt: 'select_account',
                ux_mode: 'redirect',
                redirect_uri: redirectUri // æ˜ç¤ºçš„ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’æŒ‡å®š
              }).then(function(googleUser) {
                onSignIn(googleUser);
              }).catch(function(error) {
                handleSignInError(error);
              });
            }).catch(function(error) {
              // åˆæœŸåŒ–å¤±æ•—æ™‚ã®è©³ç´°ã‚¨ãƒ©ãƒ¼å‡¦ç†
              handleAuthInitError(error);
            });
          }
        } catch (e) {
          console.error('ã‚µã‚¤ãƒ³ã‚¤ãƒ³å®Ÿè¡Œã‚¨ãƒ©ãƒ¼', e);
          showError('Googleèªè¨¼ã®å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + e.message);
          document.getElementById('fallback-signin-options').style.display = 'block';
        }
      }

      // å®Ÿéš›ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³å‡¦ç†ã‚’è¡Œã†é–¢æ•°
      function performGoogleSignIn() {
        try {
          if (googleAuth2Instance) {
            // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
            googleAuth2Instance.signIn({
              prompt: 'select_account', // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠã‚’å¼·åˆ¶
              ux_mode: 'popup'          // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
            }).then(function(googleUser) {
              onSignIn(googleUser);
            }).catch(function(error) {
              // ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã®è©³ç´°å‡¦ç†
              handleSignInError(error);
            });
          } else {
            showError('Googleèªè¨¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
          }
        } catch (e) {
          console.error('Google Sign-Inãƒœã‚¿ãƒ³æ“ä½œã‚¨ãƒ©ãƒ¼', e);
          showError('Googleèªè¨¼ã®æ“ä½œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + e.message);
          document.getElementById('fallback-signin-options').style.display = 'block';
        }
      }
      
      // ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
      function handleSignInError(error) {
        console.error('ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
        
        let errorMessage = 'Googleèªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ';
        let errorCode = '';
        
        try {
          if (error.error) {
            errorCode = error.error;
          } else if (typeof error === 'string') {
            errorCode = error;
          } else if (error.message) {
            errorCode = error.message;
          } else {
            errorCode = JSON.stringify(error);
          }
        } catch (e) {
          errorCode = 'ã‚¨ãƒ©ãƒ¼è©³ç´°ã®å–å¾—ã«å¤±æ•—';
        }
        
        // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«å¿œã˜ãŸå…·ä½“çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        if (errorCode.includes('popup_closed_by_user')) {
          errorMessage = 'ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
        } else if (errorCode.includes('popup_blocked')) {
          errorMessage = 'ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
          document.getElementById('fallback-signin-options').style.display = 'block';
        } else if (errorCode.includes('access_denied')) {
          errorMessage = 'ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚åˆ¥ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãŠè©¦ã—ãã ã•ã„ã€‚';
        } else {
          errorMessage = `Googleèªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ${errorCode}`;
          document.getElementById('fallback-signin-options').style.display = 'block';
        }
        
        showError(errorMessage);
      }
      
      // ä»£æ›¿ã‚µã‚¤ãƒ³ã‚¤ãƒ³æ–¹æ³•ã‚’è©¦ã™
      function tryAlternativeSignIn() {
        try {
          // æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§Googleã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’é–‹ã
          const authWindow = window.open('https://accounts.google.com/o/oauth2/auth' + 
            '?client_id=50428583319-gicuh9uve4gcj36a5huuhm5m0jcb3fr4.apps.googleusercontent.com' +
            '&redirect_uri=' + encodeURIComponent(window.location.origin + window.location.pathname) +
            '&response_type=token' +
            '&scope=email%20profile',
            'googleAuthWindow',
            'width=600,height=600');
          
          if (!authWindow) {
            showError('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç„¡åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚');
          } else {
            showLoading();
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤‰æ›´
            document.getElementById('loading-view').querySelector('p').textContent = 
              'Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™...';
          }
        } catch (e) {
          console.error('ä»£æ›¿ã‚µã‚¤ãƒ³ã‚¤ãƒ³å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', e);
          showError('ä»£æ›¿ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
        }
      }
      
      // Googleèªè¨¼æˆåŠŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
      function onSignIn(googleUser) {
        showLoading();
        
        try {
          // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®å–å¾—
          const profile = googleUser.getBasicProfile();
          const email = profile.getEmail();
          
          console.log('Googleèªè¨¼æˆåŠŸ: ' + email);
          
          // è¨±å¯ãƒªã‚¹ãƒˆã«ã‚ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ãƒã‚§ãƒƒã‚¯
          if (allowedEmails.includes(email)) {
            // èªè¨¼æˆåŠŸï¼šãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
            const authToken = googleUser.getAuthResponse().id_token;
            localStorage.setItem('ariel_auth_token', authToken);
            localStorage.setItem('ariel_email', email);
            
            // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
            setTimeout(() => {
              showApp(email);
            }, 1000);
          } else {
            // èªè¨¼å¤±æ•—
            if (googleAuth2Instance) {
              googleAuth2Instance.signOut().then(function() {
                showError(`ã“ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆ (${email}) ã«ã¯ã€ã“ã®ãƒšãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚`);
              });
            } else {
              showError('ã“ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯ã€ã“ã®ãƒšãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
            }
          }
        } catch (error) {
          console.error('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼', error);
          showError('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
      }
      
      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      function showError(message) {
        const errorElement = document.getElementById('errorMessage');
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        
        hideLoading();
      }
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
      function showLoading() {
        document.getElementById('login-view').classList.add('hidden');
        document.getElementById('loading-view').classList.remove('hidden');
      }
      
      function hideLoading() {
        document.getElementById('login-view').classList.remove('hidden');
        document.getElementById('loading-view').classList.add('hidden');
      }
      
      // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®è¡¨ç¤º
      function showApp(userEmail) {
        // èªè¨¼ãƒšãƒ¼ã‚¸ã‚’éè¡¨ç¤º
        document.getElementById('auth-page').style.display = 'none';
        
        // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚’è¡¨ç¤º
        document.getElementById('app').style.display = 'block';
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º
        document.getElementById('user-email').textContent = userEmail;
        document.getElementById('user-auth-status').style.display = 'flex';
      }
      
      // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆé–¢æ•°
      function logout() {
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èªè¨¼æƒ…å ±ã‚’å‰Šé™¤
        localStorage.removeItem('ariel_auth_token');
        localStorage.removeItem('ariel_email');
        
        // Googleèªè¨¼ã‚’ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ
        if (googleAuth2Instance) {
          googleAuth2Instance.signOut().then(() => {
            // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
            window.location.reload();
          });
        } else {
          window.location.reload();
        }
      }
      
      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
      document.addEventListener('DOMContentLoaded', function() {
        // ã™ã§ã«èªè¨¼æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
        const authToken = localStorage.getItem('ariel_auth_token');
        const email = localStorage.getItem('ariel_email');
        
        if (authToken && email) {
          // ã™ã§ã«èªè¨¼æ¸ˆã¿ãªã‚‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
          showApp(email);
        } else {
          // èªè¨¼ãŒå¿…è¦ãªå ´åˆ
          
          // ãƒ‡ãƒãƒƒã‚°ãƒ•ãƒ©ã‚°
          const showDebug = new URLSearchParams(window.location.search).get('debug') === '1';
          if (showDebug) {
            document.getElementById('debugInfo').style.display = 'block';
          }
          
          // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚Œã°ä½¿ç”¨ã€ãªã‘ã‚Œã°åˆæœŸåŒ–
          if (typeof gapi !== 'undefined') {
            try {
              // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç¢ºèª
              gapi.load('auth2', function() {
                try {
                  const authInstance = gapi.auth2.getAuthInstance();
                  if (authInstance) {
                    console.log('æ—¢å­˜ã®auth2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¤œå‡ºã—ã¾ã—ãŸ');
                    googleAuth2Instance = authInstance;
                    googleAuthInitialized = true;
                    setupSignInButton(authInstance);
                  } else {
                    initGoogleAuth();
                  }
                } catch (e) {
                  console.log('æ–°è¦åˆæœŸåŒ–ãŒå¿…è¦ã§ã™');
                  initGoogleAuth();
                }
              });
            } catch (e) {
              console.log('auth2ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ãŒå¿…è¦ã§ã™');
              initGoogleAuth();
            }
          } else {
            // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã‚’å¾…ã£ã¦ã‹ã‚‰åˆæœŸåŒ–
            const gapiCheckInterval = setInterval(function() {
              if (typeof gapi !== 'undefined') {
                clearInterval(gapiCheckInterval);
                initGoogleAuth();
              }
            }, 300);
            
            // é•·æ™‚é–“å¾…ã£ã¦ã‚‚èª­ã¿è¾¼ã¾ã‚Œãªã„å ´åˆ
            setTimeout(function() {
              clearInterval(gapiCheckInterval);
              if (typeof gapi === 'undefined') {
                document.getElementById('debugInfo').style.display = 'block';
                document.getElementById('debugGAPI').textContent = 'GAPIçŠ¶æ…‹: èª­ã¿è¾¼ã¿å¤±æ•—';
                showError('Googleèªè¨¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
              }
            }, 10000);
          }
        }
      });
      
      // Vue ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
      var app = new Vue({
        el:"#app",
        data:{
           knowledges:[
            {id:"0001",name:"Chat-GPT",url:"https://chatgpt.com/"},
            {id:"0002",name:"Flier",url:"https://www.flierinc.com/"},
            {id:"0003",name:"Googleãƒ‹ãƒ¥ãƒ¼ã‚¹",url:"https://news.google.com/"},
            {id:"0004",name:"çµŒæ¸ˆãƒ¬ãƒãƒ¼ãƒˆ",url:"http://www3.keizaireport.com/"},
            {id:"0005",name:"æœæ—¥æ–°è",url:"https://www.asahi.com/?iref=pc_gnavi"},
            {id:"0006",name:"NHKãƒ‹ãƒ¥ãƒ¼ã‚¹",url:"https://www3.nhk.or.jp/news/"},
            {id:"0007",name:"ãƒãƒ•ãƒã‚¹",url:"https://www.huffingtonpost.jp/"},
            {id:"0008",name:"æ±æ´‹çµŒæ¸ˆ",url:"https://toyokeizai.net/"},
            {id:"0009",name:"CNN",url:"https://www.cnn.co.jp/"},
            {id:"0010",name:"GIGAZINE",url:"https://gigazine.net/"},   
          ],
          learnings:[
            {id:"1001",name:"Schoo",url:"https://schoo.jp/"},
            {id:"1002",name:"JMOOC",url:"https://www.jmooc.jp/"},
            {id:"1003",name:"Progate",url:"https://prog-8.com/dashboard"},
            {id:"1004",name:"Udemy",url:"https://www.udemy.com/"},
          ],
          drives:[
            {id:"2001",name:"Frames",url:"https://drive.google.com/drive/u/0/folders/1T8Fr9Q_svATBleRkEWiVN9GmO6s3zcsb"},
            {id:"2002",name:"MyDrive",url:"https://drive.google.com/drive/u/0/my-drive"},
            {id:"2003",name:"swordFishâ…¢",url:"https://drive.google.com/drive/u/0/folders/1JdY8rZA2e1sUW9wQ3oyHj6Jbx60aMxL8"},
            {id:"2004",name:"DropBox",url:"https://www.dropbox.com/home"},
          ],
          gsuites:[
            {id:"3001",name:"Gmail",url:"https://mail.google.com/mail/u/1/#inbox"},
            {id:"3002",name:"GooglePhoto",url:"https://photos.google.com/u/1/?referrer=GPU&pageId=none"},
            {id:"3003",name:"Google Calendar",url:"https://calendar.google.com/calendar/r?cid=ajJkcTlrNzJpY3VrbGMzaTI1aDhnYzFyMW9AZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ"},
            {id:"3004",name:"Google Keep",url:"https://keep.google.com/u/0/#home"},
          ],
          tools:[
            {id:"4001",name:"Chat-GPT",url:"https://chatgpt.com/"},
            {id:"4002",name:"Claude",url:"https://claude.ai/new"},
            {id:"4003",name:"Dify",url:"https://cloud.dify.ai/apps"},
            {id:"4004",name:"Trello",url:"https://trello.com/b/9J0Xza0u/%E6%9D%89%E6%A3%AE%E3%81%AE%E3%83%9C%E3%83%BC%E3%83%89"},
            {id:"4005",name:"AppSheet",url:"https://www.appsheet.com/Template/Apps "},
            {id:"4006",name:"Canva",url:"https://www.canva.com/ja_jp/"},
            {id:"4007",name:"draw.io",url:"https://www.draw.io/"},
            {id:"4008",name:"NetPrint",url:"https://networkprint.ne.jp/sharp_netprint/ja/mypage.aspx"},
            {id:"4009",name:"icooon-mono",url:"https://icooon-mono.com/"},
          ],
          its:[
            {id:"5001",name:"Github",url:"https://github.com/"},
            {id:"5002",name:"Qiita",url:"https://qiita.com/"},
            {id:"5003",name:"GoogleAppsScript",url:"https://developers.google.com/apps-script/reference"},
            {id:"5004",name:"Vue.js",url:"https://012-jp.vuejs.org/guide/"},
            {id:"5005",name:"Bootstrap",url:"https://getbootstrap.jp/docs/4.2/getting-started/introduction/"},
          ],
          tvs:[
            {id:"6001",name:"Abemaãƒ‹ãƒ¥ãƒ¼ã‚¹",url:"https://abema.tv/now-on-air/abema-news"},
            {id:"6002",name:"Netflix",url:"https://www.netflix.com/browse/my-list"},
            {id:"6003",name:"AmazonPrime",url:"https://www.amazon.co.jp/gp/video/mystuff/ref=atv_nb_mystuff"},
            {id:"6004",name:"U-Next",url:"https://video.unext.jp/"},
            {id:"6005",name:"Disney+",url:"https://www.disneyplus.com/ja-jp/home"},
            {id:"6006",name:"NHKã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰",url:"https://www.nhk-ondemand.jp/#/0/"},
            {id:"6007",name:"Youtubeãƒ©ã‚¤ãƒ–ãƒ©ãƒª",url:"https://www.youtube.com/feed/library"},
            {id:"6008",name:"YoutubeãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯",url:"https://music.youtube.com/"},
            {id:"6009",name:"ãƒ‹ã‚³ãƒ‹ã‚³å‹•ç”»",url:"https://www.nicovideo.jp/my/mylist?cmnhd_ref=device%3Dpc%26site%3Dniconico%26pos%3Duserpanel%26page%3Dtop"},
            {id:"6010",name:"Pixiv",url:"https://www.pixiv.net/"},
          ],
          prvs:[
            {id:"7001",name:"Twitter",url:"https://twitter.com/home"},
            {id:"7002",name:"ä¸ƒå°¾ãˆã¿ Channel",url:"https://www.youtube.com/channel/UCNpaS7EteiT1IFigRBfW6eg"},
            {id:"7003",name:"Mirrativé…ä¿¡ç”»é¢",url:"https://www.mirrativ.com/"},
            {id:"7004",name:"ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯",url:"https://b.hatena.ne.jp/hantenasgmr/bookmark"},
            {id:"7005",name:"Facebook",url:"https://www.facebook.com/"},
            {id:"7006",name:"æ¥½å¤©éŠ€è¡Œ",url:"https://fes.rakuten-bank.co.jp/MS/main/RbS?CurrentPageID=START&&COMMAND=LOGIN"},
            {id:"7007",name:"ä¸ƒå°¾ãˆã¿FRX",url:"https://hub.vroid.com/characters/679022379978810834/models/522769586827415511"},
          ],
          showContents:["99999"],
          showNav: true,
          iframeError: false,
          alreadyOpened: false,
          errorDetails: null
        },
        watch: {
          showNav(newVal) {
            const iframe = this.$refs.fullscreenFrame;
            if (iframe) {
              iframe.style.pointerEvents = newVal ? 'none' : 'auto';
            }
          }
        },
        mounted() {
          window.addEventListener('mousemove', this.handleMouseMove);
        },
        beforeDestroy() {
          window.removeEventListener('mousemove', this.handleMouseMove);
        },
        methods:{
          handleMouseMove(e) {
            const y = e.clientY;
            this.showNav = (y < 30); // ãƒ›ãƒãƒ¼ã‚¾ãƒ¼ãƒ³ã®é«˜ã•ã«åˆã‚ã›ã‚‹
          },
          toggle: function(data) {
            this.showContents = [data];
            this.alreadyOpened = false;
            this.iframeError = false; // ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            this.errorDetails = null;
          },
          handleIframeLoad() {
            // AppSheeté–¢é€£ã®å ´åˆ
            if (this.showContents[0] === '99999') {
              // å°‘ã—é…å»¶ã•ã›ã¦åˆå›ãƒã‚§ãƒƒã‚¯
              setTimeout(() => {
                this.checkForAppSheetErrors();
              }, 300);

              // ä¸€å®šæ™‚é–“å¾Œã«ã‚‚å†ãƒã‚§ãƒƒã‚¯ï¼ˆé…å»¶èª­ã¿è¾¼ã¿ã«å¯¾å¿œï¼‰
              setTimeout(() => {
                this.checkForAppSheetErrors();
              }, 1500);
            }
          },
          
          // AppSheetã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã‚’åˆ†é›¢ã—ãŸé–¢æ•°
          checkForAppSheetErrors() {
            try {
              const iframe = this.$refs.fullscreenFrame;
              if (!iframe) return;
              
              // 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ã‚‹
              let iframeDoc;
              try {
                iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
              } catch (e) {
                // ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ã‚¨ãƒ©ãƒ¼ãªã‚‰ã°ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
                this.iframeError = true;
                console.warn("ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ãƒãƒªã‚·ãƒ¼ã«ã‚ˆã‚Šiframeã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ãã¾ã›ã‚“", e);
                return;
              }
              
              if (!iframeDoc) return;
              
              // 2. iframeå†…ã®è¦ç´ ã‹ã‚‰çŠ¶æ…‹ã‚’ç¢ºèª
              const text = iframeDoc.body.innerText || '';
              
              // 3. ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ‹¡å¼µ
              const errorPatterns = [
                "requestStorageAccess",
                "Error obtaining storage access",
                "æ¥ç¶šãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ",
                "Sign into AppSheet",
                "Why am I seeing this?",
                "denied",
                "access",
                "æ‹’å¦",
                "æ¥ç¶š",
                "error",
                "refused",
                "connection",
                "blocked",
                "ãƒ–ãƒ­ãƒƒã‚¯"
              ];
              
              const hasError = errorPatterns.some(pattern => 
                text.toLowerCase().includes(pattern.toLowerCase()));
              
              // 4. è¦‹ãŸç›®ã®ãƒã‚§ãƒƒã‚¯ã‚‚è¿½åŠ 
              const hasErrorIcon = iframeDoc.querySelector('.error-icon') || 
                                  iframeDoc.querySelector('[data-error]') ||
                                  iframeDoc.body.innerHTML.includes('face_with_raised_eyebrow');
              
              if ((hasError || hasErrorIcon) && !this.alreadyOpened) {
                this.iframeError = true;
                this.errorDetails = {
                  type: 'connection_refused',
                  message: 'AppSheetã¨ã®æ¥ç¶šãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚æ–°ã—ã„ã‚¿ãƒ–ã§ç›´æ¥é–‹ã„ã¦ãã ã•ã„ã€‚'
                };
              }
            } catch (e) {
              // ã™ã¹ã¦ã®ä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒ
              this.iframeError = true;
              console.warn("AppSheetã®èª­ã¿è¾¼ã¿ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ", e);
            }
          },
          
          // ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°
          resetAppSheetError() {
            this.iframeError = false;
            this.errorDetails = null;
          },
          
          // æ˜ç¤ºçš„ã«æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãæ©Ÿèƒ½
          openAppsheetInNewTab() {
            const appsheetUrl = "https://www.appsheet.com/start/b3cc011c-f2d9-4021-b16f-2efdd921a42b";
            window.open(appsheetUrl, '_blank');
            this.alreadyOpened = true;
          },
          
          // AppSheetã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ï¼‰
          openAppsheetFallback() {
            const appsheetUrl = "https://www.appsheet.com/start/b3cc011c-f2d9-4021-b16f-2efdd921a42b";
            window.open(appsheetUrl, '_blank');
            this.alreadyOpened = true;
          },
          
          // å•é¡Œè§£æ±ºã®ãŸã‚ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¹ãƒ†ãƒƒãƒ—
          troubleshootAppSheet() {
            const steps = [
              "1. ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨Cookieã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™",
              "2. åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§è©¦ã—ã¦ã¿ã¾ã™",
              "3. ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã¯ãªãã€å€‹äººã®å›ç·šã§è©¦ã—ã¦ã¿ã¾ã™",
              "4. Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ç›´æ¥ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¾ã™",
              "5. AppSheetã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‹ã‚‰ãƒãƒ¼ã‚¿ãƒ«ã«æˆ»ã‚Šã¾ã™"
            ];
            
            alert(steps.join("\n"));
          }
        }
      });
    </script>
  </body>
</html>
